{
  "schemaVersion": 2,
  "$schema": "https://schemas.runtipi.io/dynamic-compose.json",
  "services": [
    {
      "name": "directus",
      "image": "directus/directus:11.4.1",
      "isMain": true,
      "internalPort": 8055,
      "environment": [
        { "key": "PUBLIC_URL", "value": "${APP_PROTOCOL}://${APP_DOMAIN}" },
        { "key": "SECRET", "value": "${DIRECTUS_SECRET_KEY}" },
        { "key": "DB_CLIENT", "value": "pg" },
        { "key": "DB_HOST", "value": "directus_db" },
        { "key": "DB_PORT", "value": "5432" },
        { "key": "DB_DATABASE", "value": "directus" },
        { "key": "DB_USER", "value": "directus" },
        { "key": "DB_PASSWORD", "value": "${DIRECTUS_DB_PASSWORD}" },
        { "key": "CACHE_ENABLED", "value": "true" },
        { "key": "CACHE_AUTO_PURGE", "value": "true" },
        { "key": "CACHE_STORE", "value": "redis" },
        { "key": "REDIS", "value": "redis://directus_redis:6379" },
        { "key": "ADMIN_EMAIL", "value": "${DIRECTUS_ADMIN_EMAIL}" },
        { "key": "ADMIN_PASSWORD", "value": "${DIRECTUS_ADMIN_PASSWORD}" },
        { "key": "WEBSOCKETS_ENABLED", "value": "true" }
      ],
      "volumes": [
        { "hostPath": "${APP_DATA_DIR}/uploads", "containerPath": "/directus/uploads" },
        { "hostPath": "${APP_DATA_DIR}/extensions", "containerPath": "/directus/extensions" }
      ],
      "dependsOn": ["directus_db", "directus_redis"]
    },

    {
      "name": "directus_db",
      "image": "postgres:16-alpine",
      "environment": [
        { "key": "POSTGRES_USER", "value": "directus" },
        { "key": "POSTGRES_PASSWORD", "value": "${DIRECTUS_DB_PASSWORD}" },
        { "key": "POSTGRES_DB", "value": "directus" }
      ],
      "volumes": [
        { "hostPath": "${APP_DATA_DIR}/db", "containerPath": "/var/lib/postgresql/data" }
      ]
    },

    {
      "name": "directus_redis",
      "image": "redis:7-alpine",
      "command": ["redis-server", "--appendonly", "yes"],
      "volumes": [
        { "hostPath": "${APP_DATA_DIR}/redis", "containerPath": "/data" }
      ]
    }
  ]
}
